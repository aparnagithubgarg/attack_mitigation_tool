{% extends "base.html" %}

{% block title %}Clickjacking Attack Demo - Attack Mitigation Tool{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css">
<style>
    .code-container {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 20px;
    }
    .overlay-container {
        position: relative;
        width: 500px;
        height: 400px;
        margin: 0 auto;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: hidden;
    }
    .iframe-container {
        width: 500px;
        height: 400px;
    }
    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.01);
        z-index: 10;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .overlay-text {
        text-align: center;
        margin-bottom: 20px;
    }
    .fake-button {
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-primary text-white">
        <h2>Clickjacking Attack Demo</h2>
    </div>
    <div class="card-body">
        <div class="alert {% if secure_mode %}alert-success{% else %}alert-danger{% endif %} mb-4">
            <h4 class="alert-heading">Security Mode: {% if secure_mode %}Secure{% else %}Vulnerable{% endif %}</h4>
            <p>
                {% if secure_mode %}
                Clickjacking Protection is <strong>enabled</strong>. X-Frame-Options and Content-Security-Policy headers are being used.
                {% else %}
                Clickjacking Protection is <strong>disabled</strong>. The application is vulnerable to clickjacking attacks.
                {% endif %}
            </p>
            <form method="post" action="{{ url_for('toggle_security') }}" class="mt-2">
                <button type="submit" class="btn {% if secure_mode %}btn-outline-success{% else %}btn-outline-danger{% endif %}">
                    Switch to {% if secure_mode %}Vulnerable{% else %}Secure{% endif %} Mode
                </button>
            </form>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <h3>What is Clickjacking?</h3>
                <p>
                    Clickjacking (also known as UI redressing) is an attack that tricks a user into clicking on a hidden element
                    by overlaying it with a legitimate-looking UI element. The attacker "hijacks" clicks meant for the visible
                    page and routes them to a hidden page instead.
                </p>
                <p>
                    Clickjacking attacks can be used to:
                </p>
                <ul>
                    <li>Trick users into clicking malicious buttons or links</li>
                    <li>Steal sensitive information</li>
                    <li>Perform actions on behalf of the user without their knowledge</li>
                    <li>Activate webcams or microphones</li>
                </ul>
                <p>
                    This demo shows how clickjacking can be used to trick users into clicking a "Delete Account" button
                    when they think they're clicking a harmless button.
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h3>Clickjacking Demo</h3>
                <p>Below is a demonstration of clickjacking. The attacker creates a transparent layer that looks like a harmless button, but underneath is a button to delete your account.</p>
                
                <div class="mb-4">
                    {% if secure_mode %}
                    <div class="alert alert-info">
                        <p><strong>In secure mode, the attack is prevented.</strong> If you try to load the victim page in an iframe, it will be blocked by the browser due to the X-Frame-Options header.</p>
                        <p>You'll see an error or a blank frame below instead of the actual page content.</p>
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <p><strong>In vulnerable mode, the attack works.</strong> The victim page can be loaded in an iframe and overlaid with deceptive content.</p>
                        <p>If you click the "Win a Prize!" button below, you'll actually be clicking the "Delete Account" button on the page beneath it.</p>
                    </div>
                    {% endif %}
                </div>
                
                <div class="overlay-container">
                    <iframe src="{{ url_for('clickjacking_victim') }}" class="iframe-container" id="victim-frame"></iframe>
                    <div class="overlay">
                        <div class="overlay-text">
                            <h3>Win a Free Prize!</h3>
                            <p>Click the button below to claim your reward!</p>
                        </div>
                        <button class="fake-button" id="fake-button">Win a Prize!</button>
                    </div>
                </div>
                
                <div class="mt-3" id="result-container"></div>
            </div>

            <div class="col-md-6">
                <h3>Code Comparison</h3>
                <ul class="nav nav-tabs" id="codeTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="vulnerable-tab" data-bs-toggle="tab" data-bs-target="#vulnerable" type="button" role="tab" aria-controls="vulnerable" aria-selected="true">Vulnerable Code</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="secure-tab" data-bs-toggle="tab" data-bs-target="#secure" type="button" role="tab" aria-controls="secure" aria-selected="false">Secure Code</button>
                    </li>
                </ul>
                <div class="tab-content" id="codeTabsContent">
                    <div class="tab-pane fade show active" id="vulnerable" role="tabpanel" aria-labelledby="vulnerable-tab">
                        <div class="code-container">
                            <pre><code class="language-python">{{ vulnerable_code }}</code></pre>
                        </div>
                        <div class="alert alert-danger">
                            <h5>Vulnerability Explanation:</h5>
                            <p>The vulnerable code does not set any headers to prevent framing of the page. This allows attackers to embed the page in an iframe and overlay it with deceptive content.</p>
                            <p>Without frame-busting protections, users can be tricked into performing sensitive actions without their knowledge or consent.</p>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="secure" role="tabpanel" aria-labelledby="secure-tab">
                        <div class="code-container">
                            <pre><code class="language-python">{{ secure_code }}</code></pre>
                        </div>
                        <div class="alert alert-success">
                            <h5>Security Fix:</h5>
                            <p>The secure code sets two important headers to prevent clickjacking:</p>
                            <ol>
                                <li><code>X-Frame-Options: SAMEORIGIN</code> - Allows framing only from the same origin</li>
                                <li><code>Content-Security-Policy: frame-ancestors 'self'</code> - A more modern approach that restricts which domains can embed the page</li>
                            </ol>
                            <p>These headers tell browsers to refuse to display the page in an iframe from a different origin, preventing clickjacking attacks.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Highlight code blocks
    document.addEventListener('DOMContentLoaded', function() {
        Prism.highlightAll();
        
        // Handle the fake button click
        document.getElementById('fake-button').addEventListener('click', function() {
            const resultContainer = document.getElementById('result-container');
            resultContainer.innerHTML = '<div class="alert alert-danger mt-3">You just clicked the "Delete Account" button in the iframe beneath the overlay!</div>';
        });
    });
</script>
{% endblock %}